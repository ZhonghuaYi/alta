import os
import sys

Import('env')
env = env.Clone()

# Library sources
sources = ['common.cpp', 
           'function.cpp', 
           'params.cpp', 
           'plugins_manager.cpp', 
           'rational_function.cpp', 
           'vertical_segment.cpp']

# Special linking flags, defined in the OS dependant configuration file
env.AppendUnique(LIBS    = env['CORE_LIB'])
env.AppendUnique(CPPPATH = env['EIGEN_INC'])

## Known compilation issue. If the core is not compiled with -fvisibility-hidden
## on OSX, the shared libraries and the softwares cannot share vtables. This
## impact the use of dynamic_cast in shared libraries.
##
if sys.platform == 'darwin':
	env.AppendUnique(CCFLAGS = '-fvisibility=hidden')
#end


# We're not building a real static library, but rather what Libtool
# calls a "convenience library": an archive that contains PIC code.
# Thus, force '-fPIC'.
env.AppendUnique(CCFLAGS = ['-fPIC'])

env.StaticLibrary('../build/core', sources)
